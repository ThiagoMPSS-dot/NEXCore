<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXCore - Hytale Mod Manager</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/png" href="assets/icon.png">
    <!-- FontAwesome for Mock Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="brand">
            <div class="logo-icon">
                <img src="assets/icon.png" alt="NEXCore Logo"
                    style="width: 100%; height: 100%; object-fit: contain; border-radius: 6px;">
            </div>
            <span>NEXCore</span>
        </div>

        <button id="btn-play" class="btn-main-play" onclick="launchGame()">
            <i class="fa-solid fa-play"></i> JOGAR
        </button>

        <nav>
            <a href="#" class="nav-item active" onclick="switchView('marketplace')">
                <i class="fa-solid fa-store"></i>
                Descobrir Mods
            </a>
            <a href="#" class="nav-item" onclick="switchView('modpacks')">
                <i class="fa-solid fa-layer-group"></i>
                Meus Modpacks
            </a>
            <a href="#" class="nav-item" onclick="switchView('library')">
                <i class="fa-solid fa-folder-open"></i>
                Biblioteca Local
            </a>
            <a href="#" class="nav-item" onclick="switchView('screenshots')">
                <i class="fa-solid fa-images"></i>
                Galeria
            </a>
        </nav>

        <div style="margin-top: auto;">
            <a href="#" class="nav-item" onclick="switchView('settings')">
                <i class="fa-solid fa-gear"></i>
                Config
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Update Banner (Discreet) -->
        <div id="update-banner" class="update-banner" style="display: none;">
            <div class="update-content">
                <i class="fa-solid fa-cloud-arrow-down"></i>
                <span>Uma nova versão do <strong>NEXCore</strong> está disponível (<span
                        id="update-version">?</span>)!</span>
            </div>
            <div class="update-actions">
                <button class="btn-update-now" onclick="openUpdateLink()">Atualizar Agora</button>
                <button class="btn-update-ignore" onclick="ignoreUpdate()">Ignorar</button>
            </div>
        </div>

        <!-- Marketplace View -->
        <div id="view-marketplace">
            <div class="header">
                <div class="search-container">
                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                    <input type="text" class="search-input" placeholder="Pesquisar mods..." id="search-input"
                        onkeyup="handleSearch(event)">
                </div>
                <div style="margin-left: 20px;">
                    <select id="sort-select" onchange="runSearch()"
                        style="padding: 10px; background: var(--bg-input); color: white; border: 1px solid var(--border-color); border-radius: 8px;">
                        <option value="2">Popularidade</option>
                        <option value="6">Downloads</option>
                        <option value="3">Atualização</option>
                    </select>
                </div>
            </div>

            <div class="discovery-banner" onclick="openDiscoveryModal()" style="cursor: pointer;">
                <div class="discovery-subtitle"><i class="fa-solid fa-wand-magic-sparkles"></i> AI DISCOVERY ENGINE
                </div>
                <div class="discovery-title">Encontre sua próxima aventura</div>
            </div>

            <div id="recommended-container" style="display:none; margin-bottom: 30px;">
                <h3 style="color: #a78bfa; margin-bottom:15px"><i class="fa-solid fa-star"></i> Recomendado para Você
                </h3>
                <div class="mod-grid" id="recommended-grid"></div>
            </div>

            <div class="mod-grid" id="mod-grid">
                <!-- Mods will be injected here via JS -->
            </div>

            <div id="pagination-controls"
                style="display: flex; justify-content: center; align-items: center; gap: 20px; margin: 20px 0;">
                <button class="btn-install" id="btn-prev" onclick="changePage(-1)" disabled
                    style="width: auto; background: var(--bg-card); border: 1px solid var(--border-color);">
                    <i class="fa-solid fa-chevron-left"></i> Anterior
                </button>
                <span id="page-indicator" style="font-weight: 500;">Página 1</span>
                <button class="btn-install" id="btn-next" onclick="changePage(1)"
                    style="width: auto; background: var(--bg-card); border: 1px solid var(--border-color);">
                    Próximo <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- Modpacks View -->
        <div id="view-modpacks" style="display: none;">
            <div class="header">
                <h2>Seus Modpacks</h2>
                <div style="display:flex; gap:10px">
                    <button class="btn-install" style="width: auto; padding: 10px 20px; background: #6b7280"
                        onclick="importPackCF()">
                        <i class="fa-solid fa-file-import"></i> Importar ZIP
                    </button>
                    <button class="btn-install" style="width: auto; padding: 10px 20px;" onclick="createNewModpack()">
                        <i class="fa-solid fa-plus"></i> Novo Modpack
                    </button>
                </div>
            </div>
            <div id="modpack-list" class="modpack-list">
                <!-- Modpacks injected here -->
            </div>
        </div>

        <!-- Pack Details View -->
        <div id="view-packdetails" style="display: none;">
            <div class="header" style="gap:20px; justify-content: flex-start;">
                <button class="btn-install" style="width:auto; background: #4b5563" onclick="switchView('modpacks')">
                    <i class="fa-solid fa-arrow-left"></i> Voltar
                </button>
                <h2 id="pack-details-title">Detalhes</h2>
            </div>
            <div class="tabs-container"
                style="display: flex; gap: 20px; border-bottom: 1px solid var(--border-color); margin-bottom: 20px; padding-bottom:10px">
                <div class="tab-scroller">
                    <div class="action-btn action-active" id="tab-pack-mods" onclick="switchPackTab('mods')">Mods</div>
                    <div class="action-btn" id="tab-pack-saves" onclick="switchPackTab('saves')">Mundos (Saves)</div>
                    <div class="action-btn" id="tab-pack-console" onclick="switchPackTab('console')">Console</div>
                    <div class="action-btn" id="tab-pack-logs" onclick="switchPackTab('logs')">Logs</div>
                </div>
            </div>

            <div id="pack-mods-section">
                <div id="pack-mods-list" class="mod-grid">
                    <!-- Mods in pack injected here -->
                </div>
                <!-- Batch Actions Area (Floating) -->
                <div id="pack-batch-actions" class="batch-actions-bar" style="display:none">
                    <span id="pack-selected-count">0 selecionados</span>
                    <div style="display:flex; gap:10px">
                        <button class="btn-install" style="background:#4b5563; width:auto"
                            onclick="clearSelection()">Cancelar</button>
                        <button class="btn-install" style="background:#dc2626; width:auto"
                            onclick="removeSelectedFromPack()">Remover do Pacote</button>
                    </div>
                </div>
            </div>

            <div id="pack-saves-section" style="display: none;">
                <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
                    <button class="btn-install" style="width: auto;" onclick="openSaveView()">
                        <i class="fa-solid fa-plus"></i> Criar Novo Mundo
                    </button>
                </div>
                <div id="pack-saves-list" class="mod-grid">
                    <!-- Saves injected here -->
                </div>
            </div>

            <!-- Console Section -->
            <div id="pack-console-section" style="display: none;">
                <div style="background: #000; color: #fff; padding: 15px; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; height: 400px; overflow-y: auto; font-size: 0.9rem; line-height: 1.4;"
                    id="pack-console-terminal">
                    <div style="color: #6b7280;">Aguardando início do jogo...</div>
                </div>
                <div style="margin-top: 10px; display: flex; justify-content: flex-end;">
                    <button class="btn-install" style="width: auto; background: #4b5563;"
                        onclick="document.getElementById('pack-console-terminal').innerHTML = ''">
                        <i class="fa-solid fa-eraser"></i> Limpar Console
                    </button>
                </div>
            </div>

            <!-- Logs Section -->
            <div id="pack-logs-section" style="display: none;">
                <div style="display: grid; grid-template-columns: 250px 1fr; gap: 20px; height: 450px;">
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; overflow-y: auto; padding: 10px;"
                        id="pack-logs-sidebar">
                        <!-- Log list injected here -->
                    </div>
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; overflow-y: auto; padding: 15px; font-family: monospace; white-space: pre-wrap; font-size: 0.85rem;"
                        id="pack-logs-content">
                        Selecione um arquivo de log para visualizar.
                    </div>
                </div>
            </div>
        </div>


        <!-- Library View -->
        <div id="view-library" style="display: none;">
            <div class="header" style="justify-content: flex-start; gap: 20px">
                <h2>Mods Instalados</h2>
            </div>
            <div class="mod-grid" id="installed-grid">
                <!-- Installed mods injected here -->
            </div>
            <!-- Batch Actions Area (Floating) -->
            <div id="library-batch-actions" class="batch-actions-bar" style="display:none">
                <span id="library-selected-count">0 selecionados</span>
                <div style="display:flex; gap:10px">
                    <button class="btn-install" style="background:#4b5563; width:auto"
                        onclick="clearSelection()">Cancelar</button>
                    <button class="btn-install" style="background:#dc2626; width:auto"
                        onclick="deleteSelectedFromLibrary()">Remover Permanentemente</button>
                </div>
            </div>
        </div>

        <!-- Screenshots View -->
        <div id="view-screenshots" style="display: none;">
            <div class="header" style="justify-content: flex-start; gap: 20px">
                <h2>Galeria de Screenshots</h2>
                <button class="btn-install" style="width: auto;" onclick="loadScreenshots()">
                    <i class="fa-solid fa-rotate"></i> Atualizar
                </button>
            </div>
            <div class="mod-grid" id="screenshots-grid">
                <!-- Screenshots injected here -->
            </div>
        </div>

        <!-- Mod Details View -->
        <div id="view-moddetails" style="display: none;">
            <div class="header" style="gap:20px; justify-content: flex-start;">
                <button class="btn-install" style="width:auto; background: #4b5563" onclick="switchView('marketplace')">
                    <i class="fa-solid fa-arrow-left"></i> Voltar
                </button>
                <h2>Detalhes do Mod</h2>
            </div>

            <div id="mod-detail-container" style="padding: 20px; color: white;">
                <!-- Header Info -->
                <div
                    style="display: flex; gap: 20px; background: var(--bg-card); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <div id="detail-icon"
                        style="width: 100px; height: 100px; background-size: cover; border-radius: 12px; flex-shrink: 0;">
                    </div>
                    <div style="flex-grow: 1;">
                        <h1 id="detail-title" style="margin: 0 0 10px 0;">Mod Title</h1>
                        <p id="detail-summary" style="color: var(--text-secondary); margin-bottom: 15px;">Summary...</p>
                        <div style="display: flex; gap: 10px;">
                            <button id="detail-btn-install" class="btn-install" style="width: auto;">
                                <i class="fa-solid fa-download"></i> Instalar
                            </button>
                            <div
                                style="display: flex; flex-direction: column; justify-content: center; font-size: 0.8rem; color: var(--text-secondary);">
                                <span id="detail-downloads"></span>
                                <span id="detail-date"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Description Body & Sidebar -->
                <div style="display: grid; grid-template-columns: 1fr 300px; gap: 20px; align-items: start;">

                    <!-- Main Content (Description) -->
                    <div style="background: var(--bg-card); padding: 20px; border-radius: 12px;">
                        <h3 style="margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">
                            Descrição</h3>
                        <div id="detail-description" class="mod-description-content" style="line-height: 1.6;">
                            Carregando...
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div id="detail-sidebar" style="display: flex; flex-direction: column; gap: 20px;">
                        <!-- Injected via JS -->
                    </div>

                </div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="view-settings" style="display: none;">
            <div class="header">
                <h2>Configurações</h2>
            </div>
            <div style="background: var(--bg-card); padding: 20px; border-radius: 12px; max-width: 600px;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Diretório do Jogo
                        (Hytale)</label>
                    <input type="text" id="game-dir-input" class="search-input" placeholder="Ex: /home/user/Hytale">
                </div>

                <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="manage-saves-input" style="width: 20px; height: 20px;">
                    <label for="manage-saves-input">Gerenciar Saves por Modpack (Isolamento de Perfil)</label>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">CurseForge API Key</label>
                    <input type="password" id="api-key-input" class="search-input" placeholder="Cole sua chave aqui...">
                    <p style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 8px;">
                        Necessária para baixar mods. Obtenha em console.curseforge.com
                    </p>
                </div>

                <div style="margin-bottom: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
                    <h3 style="color: #a78bfa; margin-bottom: 15px;"><i class="fa-solid fa-robot"></i> Gemini AI
                        Configuration</h3>

                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Gemini API Key</label>
                    <input type="password" id="gemini-key-input" class="search-input"
                        placeholder="Chave do Google AI Studio">
                    <p style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 8px; margin-bottom: 15px;">
                        Para uso do AI Discovery Engine. Obtenha em aistudio.google.com
                    </p>

                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Modelo Gemini</label>
                    <select id="gemini-model-select" class="search-input"
                        style="background: var(--bg-input); color: white;">
                        <option value="gemini-2.0-flash">Gemini 2.0 Flash (Mais Rápido)</option>
                        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                        <option value="gemini-1.5-pro">Gemini 1.5 Pro (Mais Inteligente)</option>
                        <option value="gemini-1.5-flash-8b">Gemini 1.5 Flash-8B</option>
                    </select>
                </div>

                <h3 style="margin-top:30px; border-bottom:1px solid var(--border-color); padding-bottom:10px">Tradução
                </h3>

                <label class="setting-label">Idioma de Destino</label>
                <select id="setting-trans-lang" class="setting-input">
                    <option value="pt">Português (Brasil)</option>
                    <option value="en">Inglês</option>
                    <option value="es">Espanhol</option>
                    <option value="fr">Francês</option>
                    <option value="de">Alemão</option>
                    <option value="it">Italiano</option>
                    <option value="ru">Russo</option>
                    <option value="zh">Chinês</option>
                    <option value="ja">Japonês</option>
                </select>

                <div style="margin-top:20px; display:flex; align-items:center; gap:10px">
                    <input type="checkbox" id="setting-trans-auto"
                        style="width:20px; height:20px; accent-color:var(--primary-color)">
                    <label for="setting-trans-auto">Traduzir descrições automaticamente ao abrir</label>
                </div>

                <button class="btn-install" style="margin-top: 30px;" onclick="saveSettings()">Salvar
                    Configurações</button>
            </div>
        </div>

        <!-- Save Details View (Full Screen Save Editor) -->
        <div id="view-savedetails" style="display: none;">
            <div class="header" style="gap:20px; justify-content: flex-start;">
                <button class="btn-install" style="width:auto; background: #4b5563" onclick="switchView('packdetails')">
                    <i class="fa-solid fa-arrow-left"></i> Voltar
                </button>
                <h2 id="save-view-title">Editar Mundo</h2>
            </div>

            <div class="tabs-container"
                style="display: flex; gap: 20px; border-bottom: 1px solid var(--border-color); margin-bottom: 20px; padding-bottom:10px">
                <div class="tab-scroller">
                    <div class="action-btn action-active" id="tab-save-general" onclick="switchSaveTab('general')">Geral
                    </div>
                    <div class="action-btn" id="tab-save-rules" onclick="switchSaveTab('rules')">Regras</div>
                    <div class="action-btn" id="tab-save-mods" onclick="switchSaveTab('mods')">Mods do Mundo</div>
                    <div class="action-btn" id="tab-save-map" onclick="switchSaveTab('map')">Mapa do Mundo</div>
                </div>
            </div>

            <div id="save-general-section"
                style="background: var(--bg-card); padding: 25px; border-radius: 12px; max-width: 600px;">
                <div style="margin-bottom: 20px;">
                    <label class="setting-label">Nome do Mundo</label>
                    <input type="text" id="save-name-input" class="setting-input" placeholder="Meu Mundo"
                        style="width: 100%; margin-top: 8px;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label class="setting-label">Semente (Seed)</label>
                    <input type="number" id="save-seed-input" class="setting-input"
                        placeholder="Deixe vazio para aleatória" style="width: 100%; margin-top: 8px;">
                </div>

                <div style="margin-top: 30px;">
                    <button class="btn-main-play" style="width: 100%; height: 45px; font-size: 1.1rem;"
                        onclick="confirmSaveConfig()">
                        <i class="fa-solid fa-save"></i> SALVAR ALTERAÇÕES
                    </button>
                </div>
            </div>

            <div id="save-rules-section"
                style="display: none; background: var(--bg-card); padding: 25px; border-radius: 12px; max-width: 600px;">
                <div style="margin-bottom: 25px;">
                    <label class="setting-label">Modo de Jogo</label>
                    <select id="save-gamemode-select" class="setting-input" style="width: 100%; margin-top: 8px;">
                        <option value="Survival">Sobrevivência</option>
                        <option value="Creative">Criativo</option>
                    </select>
                </div>

                <div
                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <input type="checkbox" id="save-pvp-input"
                            style="width: 22px; height: 22px; accent-color: var(--primary-color);">
                        <label for="save-pvp-input" class="setting-label" style="margin: 0; cursor: pointer;">Habilitar
                            PvP</label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <input type="checkbox" id="save-fall-damage-input" checked
                            style="width: 22px; height: 22px; accent-color: var(--primary-color);">
                        <label for="save-fall-damage-input" class="setting-label"
                            style="margin: 0; cursor: pointer;">Dano de Queda</label>
                    </div>
                </div>

                <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 15px;">
                    <i class="fa-solid fa-circle-info"></i> Algumas regras podem não ser aplicadas se o modpack
                    sobrescrever as configurações padrões do mundo.
                </p>

                <div style="margin-top: 30px;">
                    <button class="btn-main-play" style="width: 100%; height: 45px; font-size: 1.1rem;"
                        onclick="confirmSaveConfig()">
                        <i class="fa-solid fa-save"></i> SALVAR ALTERAÇÕES
                    </button>
                </div>
            </div>

            <div id="save-mods-section" style="display: none;">
                <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <p style="color: var(--text-secondary); margin: 0;">Ative ou desative mods especificamente para este
                        mundo.</p>
                    <button class="btn-main-play" style="width: auto; height: 40px; padding: 0 20px;"
                        onclick="confirmSaveConfig()">
                        <i class="fa-solid fa-save"></i> SALVAR
                    </button>
                </div>
                <div id="save-mods-checklist"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; background: rgba(0,0,0,0.1); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); max-height: 500px; overflow-y: auto;">
                    <!-- Mods injected via JS -->
                </div>
            </div>

            <div id="save-map-section" style="display: none;">
                <div style="display: grid; grid-template-columns: 350px 1fr; gap: 30px;">
                    <div
                        style="background: var(--bg-card); padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                        <h3 style="margin-top:0; color: #3b82f6; margin-bottom: 20px;"><i
                                class="fa-solid fa-earth-americas"></i> Dimensões</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 15px;">Selecione qual
                            mundo do universo você deseja visualizar:</p>

                        <div style="margin-bottom: 20px;">
                            <label class="setting-label">Explorar Mundos</label>
                            <select id="save-world-select" class="setting-input" style="width: 100%; margin-top: 8px;">
                                <!-- Worlds injected via JS -->
                            </select>
                        </div>

                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn-main-play" style="width: 100%; background: #3b82f6;"
                                onclick="previewWorldMap(false)">
                                <i class="fa-solid fa-sync"></i> ATUALIZAR ALTERAÇÕES (Rápido)
                            </button>
                            <button class="action-btn"
                                style="width: 100%; height: 40px; border-radius: 8px; font-size: 0.8rem; background: rgba(255,100,100,0.1); color: #ff6b6b; border-color: rgba(255,100,100,0.2);"
                                onclick="previewWorldMap(true)">
                                <i class="fa-solid fa-broom"></i> RE-GERAR TUDO (Forçado)
                            </button>
                        </div>

                        <div
                            style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                            <i class="fa-solid fa-circle-info"></i> O renderizador processa apenas chunks que foram
                            explorados e salvos em disco.
                        </div>
                    </div>

                    <div id="save-map-container"
                        style="background: rgba(0,0,0,0.3); border: 1px solid var(--border-color); border-radius: 16px; min-height: 500px; flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; position: relative; box-shadow: inset 0 0 30px rgba(0,0,0,0.5); cursor: grab;">
                        <canvas id="save-map-canvas" style="display: none; max-width: 100%; max-height: 100%;"></canvas>

                        <div id="save-map-placeholder"
                            style="text-align: center; color: var(--text-secondary); padding: 40px;">
                            <i class="fa-solid fa-map-location-dot"
                                style="font-size: 5rem; margin-bottom: 20px; opacity: 0.2; color: #3b82f6;"></i>
                            <h3 style="margin-bottom: 10px;">Nenhum Mapa Gerado</h3>
                            <p>Selecione uma dimensão e clique em Renderizar.</p>
                        </div>

                        <!-- Map Interactive Overlay -->
                        <div id="save-map-tooltip"
                            style="position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.85); color: white; padding: 10px 15px; border-radius: 8px; border: 1px solid var(--primary-color); font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; pointer-events: none; display: none; z-index: 10; box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <span><i class="fa-solid fa-crosshairs" style="color: var(--primary-color);"></i> <span
                                        id="map-coord-txt">X: 0, Z: 0</span></span>
                                <span style="opacity: 0.5;">|</span>
                                <span><i class="fa-solid fa-cube" style="color: #10b981;"></i> <span
                                        id="map-block-txt">Gramado</span></span>
                            </div>
                        </div>

                        <!-- Copy Notification Toast (separate) -->
                        <div id="map-copy-notification"
                            style="position: absolute; top: 20px; right: 20px; background: #22c55e; color: white; padding: 12px 20px; border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; pointer-events: none; display: none; z-index: 20; box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4); transition: opacity 0.3s ease;">
                            <i class="fa-solid fa-check-circle"></i> Coordenadas copiadas!
                        </div>

                        <!-- Coords Search Widget -->
                        <div
                            style="position: absolute; top: 20px; left: 20px; display: flex; gap: 8px; z-index: 10; background: rgba(0,0,0,0.6); padding: 8px; border-radius: 12px; border: 1px solid var(--border-color); backdrop-filter: blur(10px);">
                            <div
                                style="display: flex; align-items: center; gap: 5px; background: rgba(255,255,255,0.05); padding: 5px 10px; border-radius: 8px;">
                                <span
                                    style="font-size: 0.7rem; color: var(--text-secondary); font-weight: bold;">X</span>
                                <input type="number" id="map-search-x" placeholder="0"
                                    style="width: 60px; background: transparent; border: none; color: white; font-family: 'JetBrains Mono'; font-size: 0.9rem; outline: none;">
                            </div>
                            <div
                                style="display: flex; align-items: center; gap: 5px; background: rgba(255,255,255,0.05); padding: 5px 10px; border-radius: 8px;">
                                <span
                                    style="font-size: 0.7rem; color: var(--text-secondary); font-weight: bold;">Z</span>
                                <input type="number" id="map-search-z" placeholder="0"
                                    style="width: 60px; background: transparent; border: none; color: white; font-family: 'JetBrains Mono'; font-size: 0.9rem; outline: none;">
                            </div>
                            <button class="action-btn"
                                style="width: 35px; height: 35px; border-radius: 8px; background: var(--primary-color) !important; color: white;"
                                onclick="goToMapCoords()">
                                <i class="fa-solid fa-location-arrow"></i>
                            </button>
                        </div>

                        <!-- Zoom Controls -->
                        <div
                            style="position: absolute; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 5px; z-index: 10;">
                            <button class="action-btn"
                                style="width: 40px; height: 40px; border-radius: 8px; background: rgba(0,0,0,0.6);"
                                onclick="mapViewer.zoomIn()">+</button>
                            <button class="action-btn"
                                style="width: 40px; height: 40px; border-radius: 8px; background: rgba(0,0,0,0.6);"
                                onclick="mapViewer.zoomOut()">-</button>
                            <button class="action-btn"
                                style="width: 40px; height: 40px; border-radius: 8px; background: rgba(0,0,0,0.6);"
                                onclick="mapViewer.resetView()"><i class="fa-solid fa-compress"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Discovery Modal -->
    <div id="discovery-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: var(--bg-card); padding: 30px; border-radius: 16px; width: 400px; text-align: center; border: 1px solid var(--border-color); box-shadow: 0 0 50px rgba(139, 92, 246, 0.3);">
            <i class="fa-solid fa-robot" style="font-size: 3rem; color: #a78bfa; margin-bottom: 20px;"></i>
            <h2 style="margin-bottom: 10px;">O que você busca hoje?</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">Descreva seu estilo de jogo para nossa IA
                encontrar mods perfeitos para você.</p>
            <input type="text" id="discovery-input" class="search-input"
                placeholder="Ex: Magia, RPG, Tecnologia, Dragões..." style="margin-bottom: 20px; text-align: center;">
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-install" style="background: #4b5563;"
                    onclick="closeDiscoveryModal()">Cancelar</button>
                <button class="btn-install" onclick="runDiscovery()">Analisar</button>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div id="progress-modal-overlay" class="app-modal-overlay" style="display: none;">
        <div class="app-modal active" style="text-align: center; padding: 40px;">
            <div class="loading-spinner"
                style="margin: 0 auto 20px auto; width: 50px; height: 50px; border-width: 4px;"></div>
            <h3 id="progress-modal-title">Processando...</h3>
            <p id="progress-modal-status" style="color: var(--text-secondary); margin-top: 10px;">Aguarde um momento.
            </p>
        </div>
    </div>

    <!-- Custom Modal System -->
    <div id="app-modal-overlay" class="app-modal-overlay">
        <div id="app-modal" class="app-modal">
            <h2 id="app-modal-title">Título</h2>
            <p id="app-modal-message">Mensagem aqui...</p>
            <input type="text" id="app-modal-input" class="app-modal-input" style="display: none;">
            <div id="app-modal-actions" class="app-modal-actions">
                <!-- Buttons injected via JS -->
            </div>
        </div>
    </div>

    <!-- Eel integration -->
    <script src="js/main.js"></script>
</body>

</html>